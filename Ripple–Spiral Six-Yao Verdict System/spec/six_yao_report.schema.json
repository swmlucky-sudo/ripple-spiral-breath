{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/six-yao/six_yao_report.schema.json",
  "title": "Six-Yao Verdict Report",
  "description": "Deterministic verdict report for Rippleâ€“Spiral Six-Yao arbitration (v12.2).",
  "type": "object",
  "required": [
    "version",
    "run_id",
    "timestamp",
    "panel",
    "verdict",
    "state",
    "yao",
    "constraints"
  ],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^v\\d+\\.\\d+(\\.\\w+)?$",
      "examples": ["v12.2"]
    },
    "run_id": {
      "type": "string",
      "description": "Monotonic identifier for the run, e.g., '20260116T054350+0800#2'."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "RFC3339 timestamp."
    },
    "timezone": {
      "type": "string",
      "default": "Asia/Taipei"
    },
    "panel": {
      "type": "string",
      "examples": ["PanelII.Exhale"]
    },
    "verdict": {
      "type": "string",
      "enum": ["PASS", "FAIL"],
      "description": "Overall verdict."
    },
    "state": {
      "type": "object",
      "required": ["label", "state_id"],
      "properties": {
        "label": {
          "type": "string",
          "enum": ["STABLE", "DEGRADED", "VIOLATION", "UNKNOWN"]
        },
        "state_id": {
          "type": "integer",
          "minimum": 0,
          "maximum": 63,
          "description": "6-bit mask encoded as integer (bit=1 PASS, bit=0 FAIL)."
        },
        "bit_order": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 6,
          "maxItems": 6,
          "default": [
            "InternalFeedback",
            "ExternalOutput",
            "PhaseAlignment",
            "GuardIntegrity",
            "ReleaseQuality",
            "TimeAccumulation"
          ]
        }
      }
    },
    "yao": {
      "type": "array",
      "minItems": 6,
      "maxItems": 6,
      "items": {
        "type": "object",
        "required": ["index", "name", "status"],
        "properties": {
          "index": {"type": "integer", "minimum": 1, "maximum": 6},
          "name": {
            "type": "string",
            "enum": [
              "InternalFeedback",
              "ExternalOutput",
              "PhaseAlignment",
              "GuardIntegrity",
              "ReleaseQuality",
              "TimeAccumulation"
            ]
          },
          "status": {"type": "string", "enum": ["PASS", "FAIL", "N/A"]},
          "reason": {"type": "string"},
          "metrics": {
            "type": "object",
            "additionalProperties": {
              "type": ["number", "string", "boolean", "null"]
            }
          },
          "delta": {
            "type": "object",
            "description": "Optional metric deltas vs baseline.",
            "additionalProperties": {"type": ["number", "null"]}
          },
          "threshold": {
            "type": "object",
            "description": "Optional threshold(s) used by this Yao.",
            "additionalProperties": {"type": ["number", "string", "null"]}
          }
        }
      }
    },
    "constraints": {
      "type": "object",
      "required": ["C1", "C2", "C3", "C4"],
      "properties": {
        "C1": {"$ref": "#/$defs/constraint"},
        "C2": {"$ref": "#/$defs/constraint"},
        "C3": {"$ref": "#/$defs/constraint"},
        "C4": {"$ref": "#/$defs/constraint"}
      }
    },
    "artifacts": {
      "type": "object",
      "description": "Artifact links are required on FAIL; optional on PASS.",
      "properties": {
        "png": {"$ref": "#/$defs/artifact"},
        "txt": {"$ref": "#/$defs/artifact"},
        "csv": {"$ref": "#/$defs/artifact"}
      },
      "additionalProperties": false
    },
    "notes": {
      "type": "string"
    }
  },
  "$defs": {
    "constraint": {
      "type": "object",
      "required": ["status"],
      "properties": {
        "status": {"type": "string", "enum": ["PASS", "FAIL", "N/A"]},
        "detail": {"type": "string"}
      },
      "additionalProperties": false
    },
    "artifact": {
      "type": "object",
      "required": ["available"],
      "properties": {
        "available": {"type": "boolean"},
        "uri": {"type": "string"},
        "sha256": {"type": "string"},
        "generated_at": {"type": "string", "format": "date-time"}
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {"verdict": {"const": "FAIL"}}
      },
      "then": {
        "required": ["artifacts"],
        "properties": {
          "artifacts": {
            "required": ["png", "txt", "csv"]
          }
        }
      }
    }
  ]
}
